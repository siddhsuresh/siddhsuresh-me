"Closes: #3602\r\n\r\n- [x] extract config from existing blitz.config.(ts|js)\r\n- [x] place config wrapped with ```withBlitz``` funtion in the next.config.js file\r\n\r\nI did not rename the file from blitz.config.(ts|js) to next.config.js or delete the blitz config file as it was necessary to run other steps in the codemod\r\n# Examples\r\n[Using the examples in the legacy blitz repository to test the codemod](https://github.com/blitz-js/legacy-framework/tree/main/exampleshttps://github.com/blitz-js/legacy-framework/tree/main/examples)\r\n## Example of working :\r\n### Before: \r\n[blitz.config.js](https://github.com/blitz-js/legacy-framework/blob/main/examples/auth/blitz.config.ts)\r\n```js\r\nmodule.exports = {\r\n  middleware: [\r\n    (req, res, next) => {\r\n      res.blitzCtx.referer = req.headers.referer\r\n      return next()\r\n    },\r\n  ],\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n  experimental: {\r\n    isomorphicResolverImports: true,\r\n  },\r\n  // webpack: (config, { buildId, dev, isServer, defaultLoaders, webpack }) => {\r\n  //   // Note: we provide webpack above so you should not `require` it\r\n  //   // Perform customizations to webpack config\r\n  //   // Important: return the modified config\r\n  //   return config\r\n  // },\r\n  // webpackDevMiddleware: (config) => {\r\n  //   // Perform customizations to webpack dev middleware config\r\n  //   // Important: return the modified config\r\n  //   return config\r\n  // },\r\n}\r\n```\r\n### After:\r\nnext.config.js\r\n```js\r\nimport { withBlitz } from \"@blitzjs/next\";\r\n\r\nconst config = withBlitz({\r\n   middleware: [\r\n    (req, res, next) => {\r\n      res.blitzCtx.referer = req.headers.referer\r\n      return next()\r\n    },\r\n  ],\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n\r\n  // webpack: (config, { buildId, dev, isServer, defaultLoaders, webpack }) => {\r\n  //   // Note: we provide webpack above so you should not `require` it\r\n  //   // Perform customizations to webpack config\r\n  //   // Important: return the modified config\r\n  //   return config\r\n  // },\r\n  // webpackDevMiddleware: (config) => {\r\n  //   // Perform customizations to webpack dev middleware config\r\n  //   // Important: return the modified config\r\n  //   return config\r\n  // },\r\n  experimental: {\r\n    isomorphicResolverImports: true,\r\n  }\r\n});\r\n\r\nmodule.exports = config;\r\n```\r\n\r\n## Example when config is already wrapped:\r\n### Before:\r\n[blitz.config.ts](https://github.com/blitz-js/legacy-framework/blob/main/examples/store/blitz.config.js)\r\n```ts\r\nimport {sessionMiddleware, simpleRolesIsAuthorized} from \"blitz\"\r\nimport db from \"db\"\r\nconst withBundleAnalyzer = require(\"@next/bundle-analyzer\")({\r\n  enabled: process.env.ANALYZE === \"true\",\r\n})\r\n\r\nmodule.exports = withBundleAnalyzer({\r\n  middleware: [\r\n    sessionMiddleware({\r\n      cookiePrefix: \"blitz-auth-example\",\r\n      isAuthorized: simpleRolesIsAuthorized,\r\n      // sessionExpiryMinutes: 4,\r\n      getSession: (handle) => db.session.findFirst({where: {handle}}),\r\n    }),\r\n  ],\r\n  cli: {\r\n    clearConsoleOnBlitzDev: false,\r\n  },\r\n  codegen: {\r\n    templateDir: \"./my-templates\",\r\n  },\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n  experimental: {\r\n    initServer() {\r\n      console.log(\"Hello world from initServer\")\r\n    },\r\n  },\r\n  /*\r\n  webpack: (config, {buildId, dev, isServer, defaultLoaders, webpack}) => {\r\n    // Note: we provide webpack above so you should not `require` it\r\n    // Perform customizations to webpack config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  webpackDevMiddleware: (config) => {\r\n    // Perform customizations to webpack dev middleware config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  */\r\n})\r\n```\r\n### After:\r\nnext.config.js\r\n```js\r\nimport { withBlitz } from \"@blitzjs/next\";\r\nimport {sessionMiddleware, simpleRolesIsAuthorized} from \"blitz\"\r\nimport db from \"db\"\r\nconst withBundleAnalyzer = require(\"@next/bundle-analyzer\")({\r\n  enabled: process.env.ANALYZE === \"true\",\r\n})\r\n\r\nconst config = withBlitz(withBundleAnalyzer({\r\n  middleware: [\r\n    sessionMiddleware({\r\n      cookiePrefix: \"blitz-auth-example\",\r\n      isAuthorized: simpleRolesIsAuthorized,\r\n      // sessionExpiryMinutes: 4,\r\n      getSession: (handle) => db.session.findFirst({where: {handle}}),\r\n    }),\r\n  ],\r\ncli: {\r\n    clearConsoleOnBlitzDev: false,\r\n  },\r\n\r\n  codegen: {\r\n    templateDir: \"./my-templates\",\r\n  },\r\n\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n\r\n  experimental: {\r\n    initServer() {\r\n      console.log(\"Hello world from initServer\")\r\n    },\r\n  }\r\n  /*\r\n  webpack: (config, {buildId, dev, isServer, defaultLoaders, webpack}) => {\r\n    // Note: we provide webpack above so you should not `require` it\r\n    // Perform customizations to webpack config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  webpackDevMiddleware: (config) => {\r\n    // Perform customizations to webpack dev middleware config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  */\r\n}));\r\n\r\nmodule.exports = config;\r\n```\r\n\r\n"