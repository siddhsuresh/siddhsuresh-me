[{"pull_number":3990,"title":"fix: #3989 allow `GET` requests without params","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n\r\nPlease make sure to add a changeset. Run `pnpm changeset` in the root directory to do so.\r\nThen select updated Blitz packages when prompted, and add a short message describing the changes. \r\nThe message should be user-facing — explain **what** was changed, not **how**.\r\nIgnore if there are no user-facing changes.\r\n-->\r\n\r\nCloses: #3989\r\n \r\n### What are the changes and their implications?\r\n\r\n- [x] remove the check for `params` and `meta` for `GET` requests in https://github.com/blitz-js/blitz/blob/9dc81fe958d12b662c19d4ad697aadf848d6544c/packages/blitz-rpc/src/index-server.ts#L193\r\n- [x] add URL `searchParams` only if params where passed\r\n\r\n## Bug Checklist\r\n\r\n- [x] Changeset added (run `pnpm changeset` in the root directory)\r\n- [x] rpc Integration test updated (see [test docs](https://blitzjs.com/docs/contributing#running-tests) if needed)\r\n\r\n### Example without params\r\n![image](https://user-images.githubusercontent.com/83594610/203838562-b985d47d-c824-4924-8a21-b969e0d323c7.png)\r\n\r\n### Example with params\r\n![image](https://user-images.githubusercontent.com/83594610/203838884-f19df698-d5ee-4076-b4a2-c0e378b374ee.png)\r\n![image](https://user-images.githubusercontent.com/83594610/203838901-c4006f04-7639-4b7e-9f15-2b324b6af649.png)\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3990","comments":1,"date":"2022-11-24T17:15:03Z","merged_at":"2022-11-25T23:21:41Z","commits":1,"files":5,"additions":119,"deletions":130,"state":"merged"},{"pull_number":3943,"title":"Decouple Blitz RPC and Blitz Auth","body":" <!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n \r\nPlease make sure to add a changeset. Run `pnpm changeset` in the root directory to do so.\r\nThen select updated Blitz packages when prompted, and add a short message describing the changes. \r\nThe message should be user-facing — explain **what** was changed, not **how**.\r\nIgnore if there are no user-facing changes.   \r\n--> \r\n\r\nCloses: #3663 \r\n  \r\n## What are the changes and their implications? \r\n\r\n### Implement client-side plugin `middleware` and `events` \r\n\r\nReference: https://github.com/blitz-js/blitz/pull/3943#issuecomment-1314529266\r\n \r\n#### **Blitz Auth**\r\n\r\n- [x] provide ```beforeHttpRequest``` hook to set `csrf` header on request \r\n- [x] `beforeHttpResponse` hook to read session info on response and could emit the `blitz:session-created` event to reset the queries\r\n- [x] provide `onRpcError` hook that will run on every `rpc` call to check the type of error returned by the resolver\r\n\r\n#### **Blitz RPC**\r\n\r\n- [x] consume `beforeHttpRequest` and `beforeHttpResponse` hooks (to set/read headers)\r\n- [x] consume `onRpcError` response hook \r\n- [x] consume `onSessionCreated` to invalidate queries \r\n\r\n### Dependency changes\r\n\r\n- [x] move `@blitzjs/auth` dependency of `@blitzjs/rpc` from `dependencies` to `devDependencies`  \r\n\r\n### Tests Added:\r\n> Ported the https://github.com/blitz-js/legacy-framework/tree/main/test/integration/auth integration test from the old repo, as there is currently no `integration test` that tests both `blitz-rpc` and `blitz-auth` together.\r\n\r\n- [x] Integration Tests:\r\n  - [x] Add tests for `beforeHttpRequest` and `beforeHttpResponse` middleware hooks\r\n  - [x] Add tests for `onRpcError` and `onSessionCreated` event hooks\r\n- [x] Unit Tests in `blitz` package:\r\n  - [x] Add tests for `merge`, `pipe` and `reduceBlitzPlugins` functions\r\n- [x] Update `rpc`, `rpc-path-root` and `react-query-utils` integrations tests by removing `@blitzjs/auth` dependency\r\n\r\n### Misc Changes to CI\r\n- [x] remove `turborepo` caching action as it is not being used\r\n- [x] fix `playwright` installation for integration tests\r\n\r\n## Feature Checklist\r\n\r\n- [x] Changeset added (run `pnpm changeset` in the root directory)\r\n- [x] Documentation\r\n<details>\r\n<summary>\r\n\r\n## Example Client Plugin\r\n\r\n</summary>\r\n\r\n```tsx\r\n// src/custom-plugin/plugin.tsx\r\nimport { createClientPlugin } from \"blitz\"\r\nimport { ComponentProps, ComponentType } from \"react\"\r\n\r\ntype CustomPluginOptions = {\r\n  // ... \r\n}\r\n\r\nfunction withCustomPlugin<TProps = any>(Page: ComponentType<TProps> | BlitzPage<TProps>) {\r\n  const CustomPluginRoot = (props: ComponentProps<any>) => {    \r\n    // ... custom root component\r\n    return <Page {...props} />\r\n  }\r\n  for (let [key, value] of Object.entries(Page)) {\r\n    CustomPluginRoot[key] = value\r\n  }\r\n  if (process.env.NODE_ENV !== \"production\") {\r\n    CustomPluginRoot.displayName = `CustomPluginInnerRoot`\r\n  }\r\n  return CustomPluginRoot\r\n}\r\n\r\nexport const BlitzCustomPlugin = createClientPlugin<CustomPluginOptions, {}>(\r\n  (options?: CustomPluginOptions) => {\r\n    // ... plugin code\r\n    return {\r\n      events: {\r\n        onSessionCreated: async () => {\r\n          // Called when a new session is created - Usually when the user logs in or logs out\r\n        },\r\n        onRpcError: async () => {\r\n          // Called when an RPC call fails\r\n        },\r\n      },\r\n      middleware: {\r\n        beforeHttpRequest: (req) => {\r\n          //make changes to the request options before RPC call\r\n          return req\r\n        },\r\n        beforeHttpResponse: (res) => {\r\n          //make changes to the response before returning to the caller\r\n          return res\r\n        },\r\n      },\r\n      exports: () => ({\r\n        // ... plugin exports\r\n      }),\r\n      withProvider: withCustomPlugin,\r\n    }\r\n  }\r\n)\r\n\r\n```\r\n```ts\r\n// src/blitz-client.ts\r\nimport {AuthClientPlugin} from \"@blitzjs/auth\"\r\nimport {setupBlitzClient} from \"@blitzjs/next\"\r\nimport {BlitzRpcPlugin} from \"@blitzjs/rpc\"\r\nimport {BlitzCustomPlugin} from \"./custom-plugin/plugin\"\r\n\r\nexport const {withBlitz} = setupBlitzClient({\r\n  plugins: [\r\n    AuthClientPlugin({\r\n      cookiePrefix: \"web-cookie-prefix\",\r\n    }),\r\n    BlitzRpcPlugin({}),\r\n    BlitzCustomPlugin({}),\r\n  ],\r\n})\r\n```\r\n</details>\r\n","url":"https://github.com/blitz-js/blitz/pull/3943","comments":9,"date":"2022-11-03T16:42:28Z","merged_at":null,"commits":103,"files":77,"additions":2168,"deletions":542,"state":"open"},{"pull_number":3940,"title":"Fix `cannot find module db error` in JavaScript template","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n\r\nPlease make sure to add a changeset. Run `pnpm changeset` in the root directory to do so.\r\nThen select updated Blitz packages when prompted, and add a short message describing the changes. \r\nThe message should be user-facing — explain **what** was changed, not **how**.\r\nIgnore if there are no user-facing changes.\r\n-->\r\n\r\nCloses: #3926\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] remove esbuild-register dependency to get the `cliConfig` replaced with AST parsing using `jscodeshift`\r\n- [x] allow the `blitz-server.ts` to be present in `src` directory for the `cliConfig` reading logic.\r\n\r\n## Bug Checklist\r\n\r\n- [x] Changeset added (run `pnpm changeset` in the root directory)\r\n","url":"https://github.com/blitz-js/blitz/pull/3940","comments":2,"date":"2022-11-02T04:52:28Z","merged_at":"2022-11-02T13:22:49Z","commits":4,"files":5,"additions":44,"deletions":19,"state":"merged"},{"pull_number":3933,"title":"Include resolvers in `src` in blitz console","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n\r\nPlease make sure to add a changeset. Run `pnpm changeset` in the root directory to do so.\r\nThen select updated Blitz packages when prompted, and add a short message describing the changes. \r\nThe message should be user-facing — explain **what** was changed, not **how**.\r\nIgnore if there are no user-facing changes.\r\n-->\r\n\r\nCloses: #3931\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] include src directory to scan for resolvers\r\n- [x] optimise the logic for `--only-db` flag  \r\n\r\n## Bug Checklist\r\n\r\n- [x] Changeset added (run `pnpm changeset` in the root directory)\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3933","comments":1,"date":"2022-10-31T04:58:17Z","merged_at":"2022-11-04T16:32:45Z","commits":4,"files":2,"additions":24,"deletions":21,"state":"merged"},{"pull_number":3906,"title":"Upgrade CI Syntax","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n\r\nPlease make sure to add a changeset. Run `pnpm changeset` in the root directory to do so.\r\nThen select updated Blitz packages when prompted, and add a short message describing the changes. \r\nThe message should be user-facing — explain **what** was changed, not **how**.\r\nIgnore if there are no user-facing changes.\r\n-->\r\n\r\n- [x] upgrade to the latest Github Action syntax from `set-output` to environment variables to set the integration test folders \r\n```bash\r\n::set-output name=folders::[\"auth\",\"get-initial-props\",\"middleware\",\"no-suspense\",\"qm\",\"react-query-utils\",\"rpc\",\"trailing-slash\"]\r\nWarning: The `set-output` command is deprecated and will be disabled soon. Please upgrade to using Environment Files. For more information see: https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/\r\n```\r\n![image](https://user-images.githubusercontent.com/83594610/196111190-b240be31-f4c7-4685-91a4-5f3d718b329f.png)\r\n\r\nhttps://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/\r\nhttps://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-an-output-parameter\r\n\r\n- [x] improve the detection of `no-changeset` for internal repository changes and stop changeset workflow to run after the PR is merged.\r\n\r\nPreviously it checked the latest label event, now it will check for the `no-changeset` label in all the labels that have been assigned to the PR\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3906","comments":1,"date":"2022-10-17T07:13:45Z","merged_at":"2022-10-17T07:33:36Z","commits":3,"files":3,"additions":43,"deletions":43,"state":"merged"},{"pull_number":3902,"title":"Page authenticate role","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n\r\nPlease make sure to add a changeset. Run `pnpm changeset` in the root directory to do so.\r\nThen select updated Blitz packages when prompted, and add a short message describing the changes. \r\nThe message should be user-facing — explain **what** was changed, not **how**.\r\nIgnore if there are no user-facing changes.\r\n-->\r\n\r\nCloses: #2399\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] add option `role` to the `authenicate` property to authorize users depending on their role\r\n\r\nValues that can be passed to `role` property is `string` or an `array` of `strings`\r\n\r\nUsed the following convention [mentioned in the issue]\r\n```jsx\r\n// user must be logged in\r\nPage.authenticate = true \r\n// user must be logged in and redirects otherwise\r\nPage.authenticate = { redirectTo: \"/login\" }\r\n// user must be logged in and with role \"ADMIN\" or \"USER\"\r\nPage.authenticate = { role: [\"ADMIN\", \"USER\"] }\r\n// user must be logged in with role \"ADMIN\" and redirects otherwise\r\nPage.authenticate = { role: \"ADMIN\", redirectTo: \"/login\" }\r\n```\r\n\r\n\r\n## Feature Checklist\r\n\r\n- [x] Changeset added (run `pnpm changeset` in the root directory)\r\n- [x] fixed test in  `packages\\blitz-auth\\src\\client\\auth-client.test.ts` to show `role` as public\r\n- [x] Documentation added/updated (submit PR to [blitzjs.com repo `main` branch](https://github.com/blitz-js/blitzjs.com))\r\n","url":"https://github.com/blitz-js/blitz/pull/3902","comments":5,"date":"2022-10-15T12:11:56Z","merged_at":"2022-11-09T19:57:03Z","commits":24,"files":6,"additions":62,"deletions":10,"state":"merged"},{"pull_number":3891,"title":"Add GET support to RPC specification","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #2162\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] Allow opt-in configuration to use GET requests than POST for ```query``` files [ ```mutations``` even with this config will only use POST requests]\r\n\r\n#### Example Usage\r\n```ts\r\nexport const config: ResolverConfig = {\r\n  httpMethod: \"GET\",\r\n}\r\n```\r\n- [x] Show warning to the user if URL length exceeds 2083 characters which is the minimum of the maximum URL limit set by browsers (IE and Edge 16) \r\n  - https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers/417184#417184 \r\n  - https://wiert.me/2010/04/20/maximum-url-lengths/\r\n\r\nBut, there is no practical limit for URL size for the latest browsers. So, should the warning be removed?\r\n- [x] Update the ```rpc``` tests to accept GET requests \r\n- [x] Remove updates to toolkit app - currently present to test\r\n\r\n#### TODO:\r\n - [x] Replace `esbuild` usage with `jscodeshift` to get the config from the files\r\n\r\n- [x] try shifting to `swc` from `recast` to improve performance \r\n- [x]  Remove caching layer as it is not needed anymore\r\n\r\n#### Output\r\n(Where GET request has been set for ```getProject``` and the default POST request set for ```getProjects```\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/194754005-b2c7205f-d94d-4fc0-af7a-bac851386d03.png)\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/194753926-8e4f2249-6d8c-471e-9f4f-94458c47d279.png)\r\n\r\n ","url":"https://github.com/blitz-js/blitz/pull/3891","comments":2,"date":"2022-10-09T11:24:00Z","merged_at":"2022-10-29T21:10:27Z","commits":38,"files":12,"additions":489,"deletions":412,"state":"merged"},{"pull_number":3890,"title":"Migrate Routes Command","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] migrated ```routes``` cli command from legacy blitz to blitz toolkit\r\n- [x] fix ```getDbFolder``` function in ```packages/blitz/src/cli/utils/next-console.ts``` command  to only check for ```db/schema.prisma``` if schema path defined by ```package.json``` does not exist.\r\nThe previous version would return ```db``` regardless if the user stores the schema.prisma file was present or if the user intended another to use the ```db``` folder for any other purpose \r\n- [x] matched ```blitz routes``` output to the docs https://blitzjs.com/docs/cli-routes\r\n\r\n#### Output\r\n![image](https://user-images.githubusercontent.com/83594610/194706463-d114bb64-9644-4837-a622-eb39cedc368f.png)\r\n","url":"https://github.com/blitz-js/blitz/pull/3890","comments":1,"date":"2022-10-08T12:06:20Z","merged_at":"2022-10-11T07:50:31Z","commits":4,"files":5,"additions":89,"deletions":14,"state":"merged"},{"pull_number":3888,"title":"Custom Server TS error ","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3592\r\n\r\n### What are the changes and their implications?\r\n\r\n- The error mentioned in the issue is due to esbuild currently not able to transpile lower than ```es6```.  \r\n- So added the line to the ```esbuild``` options given to build the custom server. \r\n- This config will override any target config that is configured in ```tsconfig.json``` which ```esbuild``` uses as a fallback\r\n\r\n- [x] added ```target:\"es6\"``` to the esbuild options for custom server\r\n\r\n#### Tested using example given in https://nextjs.org/docs/advanced-features/custom-server in typescript import syntax\r\n```ts\r\n// server.ts\r\nimport { createServer } from 'http'\r\nimport { parse } from 'url'\r\nimport next from 'next'\r\n\r\nconst dev = process.env.NODE_ENV !== 'production'\r\nconst hostname = 'localhost'\r\nconst port = 3000\r\n// when using middleware `hostname` and `port` must be provided below\r\nconst app = next({ dev, hostname, port })\r\nconst handle = app.getRequestHandler()\r\n\r\napp.prepare().then(() => {\r\n  createServer(async (req, res) => {\r\n    try {\r\n      // Be sure to pass `true` as the second argument to `url.parse`.\r\n      // This tells it to parse the query portion of the URL.\r\n      const parsedUrl = parse(req.url, true)\r\n      const { pathname, query } = parsedUrl\r\n\r\n      if (pathname === '/a') {\r\n        await app.render(req, res, '/a', query)\r\n      } else if (pathname === '/b') {\r\n        await app.render(req, res, '/b', query)\r\n      } else {\r\n        await handle(req, res, parsedUrl)\r\n      }\r\n    } catch (err) {\r\n      console.error('Error occurred handling', req.url, err)\r\n      res.statusCode = 500\r\n      res.end('internal server error')\r\n    }\r\n  }).listen(port, (err) => {\r\n    if (err) throw err\r\n    console.log(`> Ready on http://${hostname}:${port}`)\r\n  })\r\n})\r\n```\r\n\r\n#### Output when running ```blitz dev```\r\n![image](https://user-images.githubusercontent.com/83594610/194472716-4744fefe-2a9a-44ad-9ab3-d0e32130e58b.png)\r\n","url":"https://github.com/blitz-js/blitz/pull/3888","comments":1,"date":"2022-10-07T05:15:17Z","merged_at":"2022-10-20T06:56:40Z","commits":7,"files":3,"additions":6,"deletions":1,"state":"merged"},{"pull_number":3869,"title":"Multiple fields forms using templates during generation","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #2038\r\nCloses: #3881\r\nCloses: #2863\r\n\r\n### What are the changes and their implications?\r\nContinuing PR https://github.com/blitz-js/blitz/pull/2679/\r\n\r\n- [x] port from legacy\r\n- [x] read from ```cliConfig``` object in ```app/blitz-server.ts``` to get the user-defined codegen  \r\n- [x]  update unit tests in ```@blitzjs/generator```\r\n- [x] replace hardcoded db resolve in ```packages\\generator\\src\\utils\\get-prisma-schema.ts```\r\n- [x] update the logging setup in generator to match with blitz package \r\n- [x] fix subsequent runs with --parent or belongsTo key word - https://github.com/blitz-js/blitz/pull/2679#issuecomment-1008423700\r\n- [x] make the prisma import by mutations and queries to use the value defined in ```package.json``` \r\n- [x] https://github.com/blitz-js/legacy-framework/issues/367#issue-1297227082 - Add dropdown option through the new ```LabeledSelectField``` component  to choose parent model\r\n- [x] Add LabeledSelectField to ```formik```\r\n- [x] Add LabeledSelectField to ```react-final-form``` \r\n- [x] Update/Fix Generator Unit tests\r\n- [x] fix string default value not being wrapped in `\"...\"` mentioned in #2863  \r\n\r\n## Feature Checklist\r\n\r\n- [x] Changeset added (run `pnpm changeset` in the root directory)\r\n- [x] Integration test added (see [test docs](https://blitzjs.com/docs/contributing#running-tests) if needed)\r\n- [ ] Documentation added/updated (submit PR to [blitzjs.com repo `main` branch](https://github.com/blitz-js/blitzjs.com))\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3869","comments":2,"date":"2022-09-30T15:15:00Z","merged_at":null,"commits":50,"files":42,"additions":1565,"deletions":371,"state":"open"},{"pull_number":3868,"title":"(meta) add @siddhsuresh as maintainer","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nAdd @siddhsuresh as L1 maintainer","url":"https://github.com/blitz-js/blitz/pull/3868","comments":1,"date":"2022-09-29T14:05:01Z","merged_at":"2022-09-29T14:47:09Z","commits":2,"files":2,"additions":13,"deletions":3,"state":"merged"},{"pull_number":3866,"title":"#3748 Add custom template option back to blitz generate command","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3748\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] add type BlitzServerConfig for the types used in the ```blitz-server.ts``` config\r\n- [x] create a new command ```blitz generate custom-templates```  that generates the default templates present in the ```@blitzjs/generator``` to provide an easy starting point for the developer to use the custom templates feature \r\n   - getting custom template path from the user and using that to save the templates\r\n   - updating the ```app/blitz-sever``` file with the required changes needed to use custom templates\r\n- [x] read the named export ```cliConfig``` exported from ```app/blitz-server.{ts|js}``` and use the ```customTemplates``` property to pass the custom template path \r\n\r\n#### Example Usage\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/193023097-822f364a-cfc9-47b1-86e1-712d88679f5e.png)\r\n\r\n```ts\r\n// app/blitz-server.ts\r\nimport type { BlitzServerConfig } from \"blitz\"\r\n\r\n...\r\n\r\nexport const cliConfig: BlitzServerConfig = {\r\n  customTemplates: \"app/template\",\r\n}\r\n```\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3866","comments":2,"date":"2022-09-26T18:53:23Z","merged_at":"2022-10-12T15:46:24Z","commits":25,"files":5,"additions":156,"deletions":0,"state":"merged"},{"pull_number":3863,"title":"Migrate console","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3862\r\nCloses: #3858\r\nCloses: https://github.com/blitz-js/blitz/issues/1098\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] migrate required files from legacy framework repo \r\n- https://github.com/blitz-js/legacy-framework/blob/main/nextjs/packages/next/cli/next-console.ts\r\n- https://github.com/blitz-js/legacy-framework/blob/main/packages/cli/src/commands/console.ts\r\n- [x] use ```esbuild``` instead of ```ts-node``` with reference to https://github.com/blitz-js/blitz/issues/1098#issuecomment-823670547 \r\n- [x] add ```--only-db``` flag allows users to only load the ```db``` module in the initial load of the console but allows usage other modules when changes are made \r\n\r\n> In the following images the \"Loaded ... with the time\" is only for reference and is not present in the code\r\n\r\n### Before esbuild\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/192139300-6d169484-33c0-482a-8bb8-4b1a1ec36f07.png)\r\n\r\n### After esbuild\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/192139307-e3f56983-09fa-44b1-b31e-6c77d4fa1b44.png)\r\n\r\n### With ```skip-preload```\r\n![image](https://user-images.githubusercontent.com/83594610/192139898-d9ddb793-b995-4789-b051-c3af96a9db36.png)\r\n\r\n### If the ```db``` folder does not exist by the user provide the location of ```prisma``` schema\r\n```js\r\n//package.json\r\n\r\n\"prisma\": {\r\n    \"schema\": \"prisma/schema.prisma\"\r\n  },\r\n```\r\n![image](https://user-images.githubusercontent.com/83594610/192140639-e5937f36-5dea-4fbc-93cf-d6950769a370.png)\r\n\r\n## Only reloading the modules that are changed and not all when the user makes changes\r\n\r\n```ts\r\nconst setupFileWatchers = async (repl: REPLServer) => {\r\n  debug(\"Setting up file watchers...\")\r\n  const watchers = [\r\n    watch(await getBlitzModulePaths(), {\r\n      ignoreInitial: true,\r\n    }).on(\r\n      \"all\",\r\n      async (event:string, path: string) => { 👈🏼\r\n        const modulePath = path\r\n        const modules = await loadBlitz(false, modulePath) 👈🏼\r\n        loadBlitzModules(repl, modules)\r\n      }\r\n    )\r\n  ]\r\n```\r\n\r\nFor example when a user changes the db/index.ts file only that file is loaded by the code \r\n\r\n![image](https://user-images.githubusercontent.com/83594610/192292379-829e8db8-0b05-4f1a-8e11-bbb7d3fb3d7e.png)\r\n\r\n\r\n\r\n> pnpm blitz -v\r\nBlitz version: 2.0.0-beta.4 (local)\r\nWindows 11 | win32-x64 | Node: v16.13.0\r\n Package manager: npm\r\n  System:\r\n    OS: Windows 10 10.0.22621\r\n    CPU: (4) x64 11th Gen Intel(R) Core(TM) i3-1115G4 @ 3.00GHz\r\n    Memory: 570.32 MB / 7.70 GB\r\n  Binaries:\r\n    Node: 16.13.0 - C:\\Program Files\\nodejs\\node.EXE\r\n    Yarn: 1.22.17 - ~\\AppData\\Roaming\\npm\\yarn.CMD\r\n    npm: 8.1.0 - C:\\Program Files\\nodejs\\npm.CMD\r\n\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3863","comments":12,"date":"2022-09-25T10:23:42Z","merged_at":"2022-09-29T20:22:08Z","commits":23,"files":6,"additions":448,"deletions":167,"state":"merged"},{"pull_number":3850,"title":"#3361 Add CI action that checks if changeset was added","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3361\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] Adds a new workflow ```Changeset``` that is triggered whenever a new pull request is \r\n   - opened\r\n   - edited\r\n   - labelled\r\n\r\nThe command run is ```npx @changesets/cli status --since=origin/main``` to check whether any new changesets have been added or not. Reference from https://github.com/changesets/changesets/blob/main/docs/command-line-options.md#status\r\n\r\nThis check can be skipped if a label of ```no-changeset``` is added to the pull request by the maintainers\r\n\r\n#### Output when changeset is added\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/191903845-c7b49eef-bbec-402b-b8cc-5a1281dbb545.png)\r\n\r\n#### Output when no changeset exists\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/191903945-200c8f24-ee05-4e6c-a889-10311353d9e8.png)\r\n\r\n#### Output when ```no-changeset``` label is added to the PR\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/191904116-0d8337d5-d965-4b68-b3c3-87b5924b631b.png)\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3850","comments":1,"date":"2022-09-19T14:20:21Z","merged_at":"2022-09-23T12:22:13Z","commits":39,"files":1,"additions":27,"deletions":0,"state":"merged"},{"pull_number":3824,"title":"Update CI","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n### What are the changes and their implications?\r\n\r\n> Creating this only due to continuous failures in workflow especially in windows, sometimes due to core dumps or just exiting randomly. The tests will be run in parallel in GitHub actions as separate jobs rather than in the turbo command, which actually decreases the time taken to complete the tests from almost 7-10 mins to under 5 mins [while testing without cache]. \r\nI shall close this if deemed unnecessary. \r\n\r\n- [x] split test job in the workflow into 1) Unit tests & 2) Integration tests\r\n- [x] Taking inspiration from https://github.com/philips-labs/list-folder-action/blob/main/action.yml and creating another job to search the integration-tests folder to pass on as the argument of the Integration-test matrix\r\n- [x] Running each integration test separately using the above-passed list of subdirectories and running only those tests using the ```--filter``` argument in-built in turbo cli https://turborepo.org/docs/core-concepts/filtering.\r\n- [x] Caching only build and lint jobs while making each test run without a cache.\r\n- [x] fix auth test for windows as it is the only test that fails even separately. \r\n\r\n##### Pros:\r\n- Runs the test suite successfully in both windows and Linux\r\n\r\n##### Cons:\r\n- Increases the GitHub actions usage from 11mins [current usage] to 40-45 mins [with cache with build and lint steps] and 50 mins-1 hour [after removing cache completely] - https://github.com/siddhsuresh/blitz/actions/runs/3034971030 - PR for that https://github.com/siddhsuresh/blitz/pull/45 - If needed\r\n> Mentioning this as I am not sure whether this would cause problems.\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3824","comments":4,"date":"2022-09-11T17:01:17Z","merged_at":"2022-09-13T15:30:52Z","commits":25,"files":4,"additions":91,"deletions":32,"state":"merged"},{"pull_number":3823,"title":"#3813 Update recipes to work with blitz toolkit","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3813 \r\n\r\nFixes\r\n> Migrate over recipe functionality from legacy framework.\r\n> \r\n> Some recipes still need to be updated to work with blitz 2.0 (#3813)\r\n\r\nfrom #3784\r\n\r\n\r\n### What are the changes and their implications?\r\n- [x] updated export from ```transformBlitzConfig``` --> ```transformNextConfig``` in ```packages/blitz/src/installer/transforms/transform-next-config.ts```\r\n- [x] updated the blitz imports in the recipe templates\r\n- [x] moved the apps/pages directory to pages directory in few recipe templates to follow Nextjs file structure   \r\n- [x] recipes/secureheaders\r\n#### After\r\n```js\r\n// @ts-check\r\n\r\nconst withBundleAnalyzer = require(\"@next/bundle-analyzer\")({\r\n  enabled: process.env.ANALYZE === \"true\",\r\n})\r\nconst { withBlitz } = require(\"@blitzjs/next\")\r\n\r\n/**\r\n * @type {import('@blitzjs/next').BlitzConfig}\r\n **/\r\nconst config = {\r\n  reactStrictMode: true,\r\n\r\n  headers: async () => {\r\n    return [{\r\n      key: \"Strict-Transport-Security\",\r\n      value: \"max-age=631138519\"\r\n    }, {\r\n      key: \"X-Frame-Options\",\r\n      value: \"sameorigin\"\r\n    }, {\r\n      key: \"X-Content-Type-Options\",\r\n      value: \"nosniff\"\r\n    }, {\r\n      key: \"Permissions-Policy\",\r\n      value: \"default 'none'\"\r\n    }];\r\n  },\r\n\r\n  poweredByHeader: false\r\n}\r\n\r\nmodule.exports = withBlitz(withBundleAnalyzer(config))\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/188283722-ff3dfc58-0590-4415-882e-915af794afa7.png)\r\n\r\n - [x]  recipes/theme-ui\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/188283574-1c3aa39d-fd5d-4978-8221-416a14b9b982.png)\r\n\r\n - [x]  recipes/vanilla-extract\r\n \r\n![image](https://user-images.githubusercontent.com/83594610/188283503-8df73897-4de0-4a6a-b70a-ef4356c471d3.png)\r\n","url":"https://github.com/blitz-js/blitz/pull/3823","comments":12,"date":"2022-09-09T04:03:59Z","merged_at":"2022-09-15T12:42:45Z","commits":20,"files":16,"additions":132,"deletions":113,"state":"merged"},{"pull_number":3810,"title":"Fix remote caching in CI","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: ?\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] Change the server-token given to the ```felixmosh/turborepo-gh-artifacts@v1``` GitHub action from secret value to pre-defined random 36 hex value generated by ```openssl```.\r\n\r\nThis is requested to be changed as GitHub only allows actions triggered from within the repository the access the secrets defined in the repository, with the exception of the ```GITHUB_TOKEN```\r\n\r\nhttps://docs.github.com/en/actions/security-guides/encrypted-secrets#using-encrypted-secrets-in-a-workflow\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/187928259-10501dcb-ba38-4e12-84dd-8b98dacb7532.png)\r\n\r\nSo, whenever a fork triggers the action the windows test fails most of the time due to an exit of a test as the remote caching feature of turbo is not enabled due to a null string being passed as the server-token argument\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/187926354-c735afda-6931-42ae-b2ad-229aae6232cb.png)\r\n","url":"https://github.com/blitz-js/blitz/pull/3810","comments":2,"date":"2022-09-01T13:39:11Z","merged_at":"2022-09-06T16:31:31Z","commits":3,"files":1,"additions":14,"deletions":10,"state":"merged"},{"pull_number":3809,"title":"#3804 Show file path on error","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3804\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] wrap the logic of the steps inside the ```getAllFiles``` function with a ```try...catch``` block to get the file name during errors","url":"https://github.com/blitz-js/blitz/pull/3809","comments":1,"date":"2022-09-01T13:11:51Z","merged_at":"2022-09-07T13:18:23Z","commits":6,"files":2,"additions":274,"deletions":230,"state":"merged"},{"pull_number":3803,"title":"Codemod should convert import statements to require when creating next.config.js","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3800\r\n\r\n**Testing using https://github.com/blitz-js/legacy-framework/blob/main/examples/auth/blitz.config.ts**\r\n\r\n## Before\r\n```ts\r\n//blitz.config.ts\r\nimport {sessionMiddleware, simpleRolesIsAuthorized} from \"blitz\"\r\nimport db from \"db\"\r\nconst withBundleAnalyzer = require(\"@next/bundle-analyzer\")({\r\n  enabled: process.env.ANALYZE === \"true\",\r\n})\r\n\r\nmodule.exports = withBundleAnalyzer({\r\n  middleware: [\r\n    sessionMiddleware({\r\n      cookiePrefix: \"blitz-auth-example\",\r\n      isAuthorized: simpleRolesIsAuthorized,\r\n      // sessionExpiryMinutes: 4,\r\n      getSession: (handle) => db.session.findFirst({where: {handle}}),\r\n    }),\r\n  ],\r\n  cli: {\r\n    clearConsoleOnBlitzDev: false,\r\n  },\r\n  codegen: {\r\n    templateDir: \"./my-templates\",\r\n  },\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n  experimental: {\r\n    initServer() {\r\n      console.log(\"Hello world from initServer\")\r\n    },\r\n  },\r\n  /*\r\n  webpack: (config, {buildId, dev, isServer, defaultLoaders, webpack}) => {\r\n    // Note: we provide webpack above so you should not `require` it\r\n    // Perform customizations to webpack config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  webpackDevMiddleware: (config) => {\r\n    // Perform customizations to webpack dev middleware config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  */\r\n})\r\n```\r\n\r\n## After\r\n```js\r\n//next.config.js\r\nconst db = require(\"db\");\r\nconst {sessionMiddleware, simpleRolesIsAuthorized} = require(\"blitz\");\r\nconst { withBlitz } = require(\"@blitzjs/next\");\r\nconst withBundleAnalyzer = require(\"@next/bundle-analyzer\")({\r\n  enabled: process.env.ANALYZE === \"true\",\r\n})\r\n\r\nmodule.exports = withBlitz(withBundleAnalyzer({\r\n  cli: {\r\n    clearConsoleOnBlitzDev: false,\r\n  },\r\n\r\n  codegen: {\r\n    templateDir: \"./my-templates\",\r\n  },\r\n\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n\r\n  experimental: {\r\n    initServer() {\r\n      console.log(\"Hello world from initServer\")\r\n    },\r\n  }\r\n  /*\r\n  webpack: (config, {buildId, dev, isServer, defaultLoaders, webpack}) => {\r\n    // Note: we provide webpack above so you should not `require` it\r\n    // Perform customizations to webpack config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  webpackDevMiddleware: (config) => {\r\n    // Perform customizations to webpack dev middleware config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  */\r\n}));\r\n```","url":"https://github.com/blitz-js/blitz/pull/3803","comments":2,"date":"2022-08-30T14:30:45Z","merged_at":"2022-08-30T17:25:33Z","commits":6,"files":2,"additions":42,"deletions":1,"state":"merged"},{"pull_number":3799,"title":"Add Windows Testing to CI","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3271\r\n\r\n### What are the changes and their implications?\r\n\r\n#### Changes in ```.github/workflows/main.yml```\r\n- [x] Create 4 jobs - Lint, Build, Linux Test, Windows Test\r\n- [x] Enable the remote caching feature in turbo using [felixmosh/turborepo-gh-artifacts](https://github.com/felixmosh/turborepo-gh-artifacts) Github Action\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/187253253-2f6704ad-8668-4599-bc29-be95579482bd.png)\r\n\r\n![image](https://user-images.githubusercontent.com/83594610/187214521-f348cee6-a4ce-4002-9707-d8c4143042ca.png)\r\n⬆️ Build and test speeds after first run\r\nhttps://github.com/siddhsuresh/blitz/actions/runs/2948884996\r\n\r\n- [x] **TODO: Add ```TURBO_SERVER_TOKEN``` to GitHub secrets in order to enable the remote caching using GitHub artifacts**\r\n\r\n#### Bug Fixes to enable the tests in windows\r\n- [x] Fixed error in generation of route name for **nested routes** in ```@blitzjs/rpc``` in ```packages/blitz-rpc/src/loader-utils.ts```\r\n```js\r\n  return filePath\r\n    .replace(/^.*?[\\\\/]queries[\\\\/]/, \"/\")\r\n    .replace(/^.*?[\\\\/]mutations[\\\\/]/, \"/\")\r\n    .replace(/\\\\/g, \"/\") 👈🏼\r\n    .replace(fileExtensionRegex, \"\")\r\n```\r\n##### Before in windows\r\n![image](https://user-images.githubusercontent.com/83594610/187218077-e528ff7b-d112-4eb5-804f-890e96d3d34f.png)\r\n\r\n‼️**The ```\"/v2\\getCurrentUser\"``` gets converted to ```/v2getCurrentUser``` in windows which causes the routePath in the resolverMap in ```blitz-rpc/index-server.ts``` not to match when users are using nested paths.**\r\n\r\n##### After in windows\r\n![image](https://user-images.githubusercontent.com/83594610/187216404-ccdeac7a-ef75-423a-b1c1-0b8aae5e83b4.png)\r\n\r\n- [x] Remove ```NODE_ENV=production``` from the build scripts of the ```apps/*``` as it is not supported in windows [next build will set the NODE_ENV as production by default]\r\n\r\n- [x] Update the ```index.test.ts``` file in ```integration-tests/auth``` from explicitly calling the ```seed``` function to now adding the ```prisma reset``` and ```prisma db seed``` commands to the ```package.json```. \r\n❓The seed function previously called from the test file was not updating the database, causing the test to fail in windows.\r\n- [x] Increasing the hookTimeout time in the ```integration-tests/react-query-utils/vitest.config.ts``` file to pass the tests in windows\r\n\r\n\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3799","comments":2,"date":"2022-08-29T14:11:54Z","merged_at":"2022-08-30T22:32:48Z","commits":77,"files":11,"additions":196,"deletions":20,"state":"merged"},{"pull_number":3788,"title":"#3783 #3785 Update codemod imports","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3783, #3785\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] import getAntiCSRFToken from ```@blitzjs/auth``` not ```@blitzjs/rpc```\r\n- [x] import  AuthenticatedMiddlewareCtx from ```@blitzjs/rpc``` not ```@blitz/rpc```\r\n\r\n## Feature Checklist\r\n\r\n- [x] Documentation updated (submit PR to [blitzjs.com repo `main` branch](https://github.com/blitz-js/blitzjs.com)\r\n","url":"https://github.com/blitz-js/blitz/pull/3788","comments":1,"date":"2022-08-24T05:42:22Z","merged_at":"2022-08-24T08:57:42Z","commits":3,"files":2,"additions":7,"deletions":2,"state":"merged"},{"pull_number":3780,"title":"#3775 Only generate prisma client if it has not been generated","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3775\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] create a temporary ```blitz-prisma-status.json``` file in the temp directory\r\n- [x] store the last modified time of the ```db/prisma.schema``` and store it in the json file\r\n- [x] check if the modified time of the schema file has changed since the last prisma client generation by the codegen  ","url":"https://github.com/blitz-js/blitz/pull/3780","comments":1,"date":"2022-08-23T14:58:27Z","merged_at":"2022-08-23T16:25:10Z","commits":9,"files":2,"additions":33,"deletions":9,"state":"merged"},{"pull_number":3764,"title":"convert invokeWithMiddleware to resolver call in codemod","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: ?\r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] convert invokeWithMiddleware to resolver call\r\n\r\n## Example\r\n### Before\r\n```ts\r\nexport const getServerSideProps = gSSP<Props>(async ({\r\n  req,\r\n  res,\r\n}) => {\r\n  const user = invokeWithMiddleware(getUserQuery, {},{req,res})\r\n  const user2 = invokeWithMiddleware(getUserQuery2, {},{req,res})\r\n  return {\r\n    props: {\r\n      user,\r\n      user2\r\n    },\r\n  }\r\n})\r\n```\r\n### After\r\n```ts\r\nexport const getServerSideProps = gSSP<Props>(async ({\r\n  req,\r\n  res,\r\n}) => {\r\n  const user = getUserQuery({},{req,res});\r\n  const user2 = getUserQuery2({},{req,res});\r\n  return {\r\n  props: {\r\n      user,\r\n      user2\r\n    },\r\n  }\r\n})\r\n```","url":"https://github.com/blitz-js/blitz/pull/3764","comments":4,"date":"2022-08-21T17:08:48Z","merged_at":"2022-09-14T18:38:05Z","commits":17,"files":2,"additions":28,"deletions":31,"state":"merged"},{"pull_number":3763,"title":"show file name when unexpected error occurs","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3760 \r\n\r\n### What are the changes and their implications?\r\n\r\n- [x] add try catch block around the wrap gSP, gSSP and api loops to show the file name that is causing the error.\r\n- [x] created a progress like display showing the file name currently being processed to the used\r\n- [x] fixed an unexpected error during the _document.tsx step when .get() is being called when it could be null  \r\n","url":"https://github.com/blitz-js/blitz/pull/3763","comments":1,"date":"2022-08-21T16:35:05Z","merged_at":"2022-08-22T18:26:30Z","commits":3,"files":1,"additions":57,"deletions":49,"state":"merged"},{"pull_number":3753,"title":"Fix #3737 Fix eslint config using the codemod","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3737\r\n\r\n### What are the changes and their implications?\r\n- [x] Add a new codemod step to update the .eslintrc.js file to ```module.exports=require(\"@blitzjs/next/eslint\")```","url":"https://github.com/blitz-js/blitz/pull/3753","comments":2,"date":"2022-08-18T15:02:13Z","merged_at":"2022-08-19T13:33:10Z","commits":7,"files":3,"additions":47,"deletions":15,"state":"merged"},{"pull_number":3746,"title":"Fix #3745 Change ES6 import to require syntax","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\nCloses: #3745\r\n- [x] replace ```import { withBlitz } from \"@blitzjs/next\"``` to  ```const { withBlitz } = require(\"@blitzjs/next\")```\r\n","url":"https://github.com/blitz-js/blitz/pull/3746","comments":1,"date":"2022-08-17T01:59:08Z","merged_at":"2022-08-17T14:44:53Z","commits":6,"files":2,"additions":13,"deletions":2,"state":"merged"},{"pull_number":3736,"title":"Fix #3735 Add Script as a Default Import of Next.js","body":"<!--\r\nThanks for opening a PR! Your contribution is much appreciated.\r\nTo make sure your PR is handled as smoothly as possible please:\r\n - Link issue via \"Closes #[issue_number]\r\n - Choose & follow the right checklist for the change that you're making:\r\n-->\r\n\r\n- [x] Add Script as a default import \r\n\r\nCloses: #3735\r\n","url":"https://github.com/blitz-js/blitz/pull/3736","comments":2,"date":"2022-08-15T15:03:56Z","merged_at":"2022-08-17T15:03:29Z","commits":9,"files":2,"additions":18,"deletions":0,"state":"merged"},{"pull_number":3709,"title":"#3602 Fix the way next.config.js file is created by the codemod","body":"Closes: #3602\r\n\r\n- [x] extract config from existing blitz.config.(ts|js)\r\n- [x] place config wrapped with ```withBlitz``` funtion in the next.config.js file\r\n\r\nI did not rename the file from blitz.config.(ts|js) to next.config.js or delete the blitz config file as it was necessary to run other steps in the codemod\r\n# Examples\r\n[Using the examples in the legacy blitz repository to test the codemod](https://github.com/blitz-js/legacy-framework/tree/main/exampleshttps://github.com/blitz-js/legacy-framework/tree/main/examples)\r\n## Example of working :\r\n### Before: \r\n[blitz.config.js](https://github.com/blitz-js/legacy-framework/blob/main/examples/auth/blitz.config.ts)\r\n```js\r\nmodule.exports = {\r\n  middleware: [\r\n    (req, res, next) => {\r\n      res.blitzCtx.referer = req.headers.referer\r\n      return next()\r\n    },\r\n  ],\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n  experimental: {\r\n    isomorphicResolverImports: true,\r\n  },\r\n  // webpack: (config, { buildId, dev, isServer, defaultLoaders, webpack }) => {\r\n  //   // Note: we provide webpack above so you should not `require` it\r\n  //   // Perform customizations to webpack config\r\n  //   // Important: return the modified config\r\n  //   return config\r\n  // },\r\n  // webpackDevMiddleware: (config) => {\r\n  //   // Perform customizations to webpack dev middleware config\r\n  //   // Important: return the modified config\r\n  //   return config\r\n  // },\r\n}\r\n```\r\n### After:\r\nnext.config.js\r\n```js\r\nimport { withBlitz } from \"@blitzjs/next\";\r\n\r\nconst config = withBlitz({\r\n   middleware: [\r\n    (req, res, next) => {\r\n      res.blitzCtx.referer = req.headers.referer\r\n      return next()\r\n    },\r\n  ],\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n\r\n  // webpack: (config, { buildId, dev, isServer, defaultLoaders, webpack }) => {\r\n  //   // Note: we provide webpack above so you should not `require` it\r\n  //   // Perform customizations to webpack config\r\n  //   // Important: return the modified config\r\n  //   return config\r\n  // },\r\n  // webpackDevMiddleware: (config) => {\r\n  //   // Perform customizations to webpack dev middleware config\r\n  //   // Important: return the modified config\r\n  //   return config\r\n  // },\r\n  experimental: {\r\n    isomorphicResolverImports: true,\r\n  }\r\n});\r\n\r\nmodule.exports = config;\r\n```\r\n\r\n## Example when config is already wrapped:\r\n### Before:\r\n[blitz.config.ts](https://github.com/blitz-js/legacy-framework/blob/main/examples/store/blitz.config.js)\r\n```ts\r\nimport {sessionMiddleware, simpleRolesIsAuthorized} from \"blitz\"\r\nimport db from \"db\"\r\nconst withBundleAnalyzer = require(\"@next/bundle-analyzer\")({\r\n  enabled: process.env.ANALYZE === \"true\",\r\n})\r\n\r\nmodule.exports = withBundleAnalyzer({\r\n  middleware: [\r\n    sessionMiddleware({\r\n      cookiePrefix: \"blitz-auth-example\",\r\n      isAuthorized: simpleRolesIsAuthorized,\r\n      // sessionExpiryMinutes: 4,\r\n      getSession: (handle) => db.session.findFirst({where: {handle}}),\r\n    }),\r\n  ],\r\n  cli: {\r\n    clearConsoleOnBlitzDev: false,\r\n  },\r\n  codegen: {\r\n    templateDir: \"./my-templates\",\r\n  },\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n  experimental: {\r\n    initServer() {\r\n      console.log(\"Hello world from initServer\")\r\n    },\r\n  },\r\n  /*\r\n  webpack: (config, {buildId, dev, isServer, defaultLoaders, webpack}) => {\r\n    // Note: we provide webpack above so you should not `require` it\r\n    // Perform customizations to webpack config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  webpackDevMiddleware: (config) => {\r\n    // Perform customizations to webpack dev middleware config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  */\r\n})\r\n```\r\n### After:\r\nnext.config.js\r\n```js\r\nimport { withBlitz } from \"@blitzjs/next\";\r\nimport {sessionMiddleware, simpleRolesIsAuthorized} from \"blitz\"\r\nimport db from \"db\"\r\nconst withBundleAnalyzer = require(\"@next/bundle-analyzer\")({\r\n  enabled: process.env.ANALYZE === \"true\",\r\n})\r\n\r\nconst config = withBlitz(withBundleAnalyzer({\r\n  middleware: [\r\n    sessionMiddleware({\r\n      cookiePrefix: \"blitz-auth-example\",\r\n      isAuthorized: simpleRolesIsAuthorized,\r\n      // sessionExpiryMinutes: 4,\r\n      getSession: (handle) => db.session.findFirst({where: {handle}}),\r\n    }),\r\n  ],\r\ncli: {\r\n    clearConsoleOnBlitzDev: false,\r\n  },\r\n\r\n  codegen: {\r\n    templateDir: \"./my-templates\",\r\n  },\r\n\r\n  log: {\r\n    // level: \"trace\",\r\n  },\r\n\r\n  experimental: {\r\n    initServer() {\r\n      console.log(\"Hello world from initServer\")\r\n    },\r\n  }\r\n  /*\r\n  webpack: (config, {buildId, dev, isServer, defaultLoaders, webpack}) => {\r\n    // Note: we provide webpack above so you should not `require` it\r\n    // Perform customizations to webpack config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  webpackDevMiddleware: (config) => {\r\n    // Perform customizations to webpack dev middleware config\r\n    // Important: return the modified config\r\n    return config\r\n  },\r\n  */\r\n}));\r\n\r\nmodule.exports = config;\r\n```\r\n\r\n","url":"https://github.com/blitz-js/blitz/pull/3709","comments":5,"date":"2022-08-10T19:13:44Z","merged_at":"2022-08-11T15:11:24Z","commits":10,"files":2,"additions":31,"deletions":23,"state":"merged"}]